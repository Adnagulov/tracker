<!doctype html>
<html lang="ru" data-theme="dark">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–ì—Ä–∞—Ñ–∏–∫–∏</title>
<link rel="icon" href="favicon.png" type="image/svg+xml" />
<style>
 body{margin:0;font-family:Inter,system-ui;background:var(--bg);color:var(--text)}
 :root{--bg:#0f172a;--card:#111827;--text:#e6eef8;--muted:#94a3b8;--border:#1f2937}
 [data-theme="light"]{--bg:#ffffff;--card:#f8fafc;--text:#0f172a;--muted:#374151;--border:#e5e7eb}
 .wrap{max-width:980px;margin:0 auto;padding:12px}
 header{padding:12px;border-bottom:1px solid var(--border);background:rgba(0,0,0,.05)}
 .card{background:var(--card);border:1px solid var(--border);padding:16px;border-radius:12px;margin-bottom:12px}
 canvas{width:100%!important;height:300px!important}
 .small{font-size:13px;color:var(--muted)}
 .btn{padding:8px 12px;border-radius:10px;border:1px solid var(--border);background:transparent;color:var(--text);cursor:pointer;font-weight:600}
 .btn:hover{background:#3b82f6;color:#fff}
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
<header>
  <div class="wrap" style="display:flex;justify-content:space-between;align-items:center">
    <div class="small">–ì—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ ‚Ä¢ –¥–∞–Ω–Ω—ã–µ —á–∏—Ç–∞—é—Ç—Å—è –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (–∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑ –æ–±–ª–∞–∫–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π).</div>
    <div>
      <button id="themeBtn" class="btn">üåô/‚òÄÔ∏è</button>
      <a href="index.html" class="btn">‚Üê –ù–∞–∑–∞–¥</a>
    </div>
  </div>
</header>

<div class="wrap">
  <div class="card"><h3 style="margin:0">–í–µ—Å (—Ñ–∞–∫—Ç) vs —Ü–µ–ª–µ–≤–æ–π</h3><canvas id="weightChart"></canvas></div>
  <div class="card"><h3 style="margin:0">–û–±—ä—ë–º –∂–∏–≤–æ—Ç–∞</h3><canvas id="waistChart"></canvas></div>
  <div class="card"><h3 style="margin:0">–û–±—ä—ë–º –±–∏—Ü–µ–ø—Å–∞</h3><canvas id="bicepsChart"></canvas></div>
  <div class="card"><h3 style="margin:0">–û–±—ä—ë–º –∫–≤–∞–¥—Ä–∏—Ü–µ–ø—Å–∞</h3><canvas id="quadChart"></canvas></div>
</div>

<script>
/* theme */
(function(){ const t=localStorage.getItem('theme')||'dark'; document.documentElement.setAttribute('data-theme', t); })();
document.getElementById('themeBtn').onclick=()=>{ const cur=document.documentElement.getAttribute('data-theme'); const next=cur==='dark'?'light':'dark'; document.documentElement.setAttribute('data-theme', next); localStorage.setItem('theme', next); };

/* Supabase (–Ω–∞ —Å–ª—É—á–∞–π –ø—Ä—è–º–æ–π sync) */
const SUPABASE_URL = "https://afxbyrypaqnobaalipjm.supabase.co";
const SUPABASE_ANON_KEY = "sb_publishable_vROzTIfTCdtiea3xfMCcHA_bthD-zZr";
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

/* target plan */
const TARGET = [
  ['2025-09-17',97],['2025-09-23',95.9],['2025-09-30',94.7],['2025-10-07',93.6],
  ['2025-10-14',92.5],['2025-10-21',91.3],['2025-10-28',90.2],['2025-11-04',89.1],
  ['2025-11-11',87.9],['2025-11-18',86.8],['2025-11-25',85.7],['2025-12-02',84.5],
  ['2025-12-09',83.4],['2025-12-16',82.3],['2025-12-23',81.1],['2025-12-30',80.0]
];

function pad(n){ return String(n).padStart(2,'0'); }
function ymd(d){ return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`; }

function collectLocalSeries(){
  const labels = TARGET.map(t=>t[0]);
  const weightActual = labels.map(lbl => {
    const v = localStorage.getItem(`metric:${lbl}:weight`);
    return v ? Number(v) : null;
  });
  const waist = labels.map(lbl => { const v = localStorage.getItem(`circ:${lbl}:waist`); return v?Number(v):null; });
  const biceps = labels.map(lbl => { const v = localStorage.getItem(`circ:${lbl}:biceps`); return v?Number(v):null; });
  const quad = labels.map(lbl => { const v = localStorage.getItem(`circ:${lbl}:quad`); return v?Number(v):null; });
  const target = TARGET.map(t=>t[1]);
  return { labels, weightActual, waist, biceps, quad, target };
}


function fmtLabel(lbl){
  // lbl like '2025-09-17' -> '17.09'
  const [y,m,d] = lbl.split('-');
  return d+'.'+m;
}
function mkLine(ctx, labels, datasets){

  return new Chart(ctx, {
    type:'line',
    data:{ labels, datasets },
    options:{
      responsive:true, interaction:{mode:'index',intersect:false},
      plugins:{legend:{display:true, labels:{boxWidth:10, font:{size:11}}}}, scales:{
        x:{ ticks:{ callback:(v,i,vals)=> fmtLabel(this.getLabelForValue ? this.getLabelForValue(v): labels[v]||''), maxRotation:0, autoSkip:true, font:{size:10} } },
        y:{ beginAtZero:false, ticks:{ font:{size:10} } }
      }
    }
  });
}

function renderCharts(){
  const s = collectLocalSeries();
  mkLine(document.getElementById('weightChart').getContext('2d'), s.labels, [
    { label:'–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –≤–µ—Å', data: s.weightActual, borderColor:'#3b82f6', fill:false, tension:0.2, spanGaps:true },
    { label:'–¶–µ–ª–µ–≤–æ–π –≤–µ—Å', data: s.target, borderColor:'#ef4444', borderDash:[6,4], fill:false, tension:0.2 }
  ]);
  mkLine(document.getElementById('waistChart').getContext('2d'), s.labels, [{ label:'–ñ–∏–≤–æ—Ç (—Å–º)', data: s.waist, borderColor:'#34d399', fill:false, spanGaps:true }]);
  mkLine(document.getElementById('bicepsChart').getContext('2d'), s.labels, [{ label:'–ë–∏—Ü–µ–ø—Å (—Å–º)', data: s.biceps, borderColor:'#60a5fa', fill:false, spanGaps:true }]);
  mkLine(document.getElementById('quadChart').getContext('2d'), s.labels, [{ label:'–ö–≤–∞–¥—Ä–∏—Ü–µ–ø—Å (—Å–º)', data: s.quad, borderColor:'#f59e0b', fill:false, spanGaps:true }]);
}

renderCharts();
</script>
</body>
</html>
